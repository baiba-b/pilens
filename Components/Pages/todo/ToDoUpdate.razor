@page "/ToDo/update/{TaskId:int}"
@inject NavigationManager Navigation
@rendermode InteractiveServer
@using Pilens.Data.Models

<MudPaper Class="mt-2 pa-3 d-inline-block">
    <MudCardContent>
        <EditForm method="post" Model="@todoTask" autocomplete="off" OnValidSubmit="UpdateTask">
            <DataAnnotationsValidator />

            <MudTextField @bind-Value="todoTask.Title"
                          Label="Nosaukums"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.Title)" />
            <MudTextField @bind-Value="todoTask.Description"
                          Label="Apraksts"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.Description)" />

            <MudStack Direction="Row" Spacing="2">
                <MudTextField @bind-value="todoTask.EffortDuration"
                              Label="hh:mm"
                              Mask="@(new PatternMask("00:00"))"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="00:30" />
                <MudTextField @bind-value="todoTask.Effort"
                              Label="1-3"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="0" />

            </MudStack>

            <MudTextField T="DateTime"
                          @bind-Value="todoTask.Deadline"
                          InputType="InputType.DateTimeLocal"
                          Label="Termiņš"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.Deadline)" />

            <MudStack Direction="Row" AlignItems=AlignItems.Center Spacing="1">
                <MudSwitch @bind-Checked="todoTask.IsCompleted"
                           Color="Color.Success"
                           Label="Pabeigts"
                           For="@(() => todoTask.IsCompleted)" />

                <MudTextField @bind-Value="todoTask.Identifier"
                              Label="Saraksts / identifikators"
                              Variant="Variant.Outlined"
                              Margin="Margin.Dense"
                              For="@(() => todoTask.Identifier)" />
            </MudStack>

            <MudStack Direction="Row" Spacing="2">
                <MudNumericField T="int"
                                 @bind-Value="todoTask.SessionsRequired"
                                 Label="Nepieciešamās sesijas"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Min="0"
                                 For="@(() => todoTask.SessionsRequired)" />

                <MudNumericField T="int"
                                 @bind-Value="todoTask.ProgressCurrentUnits"
                                 Label="Esošais progress"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Min="0"
                                 For="@(() => todoTask.ProgressCurrentUnits)" />

                <MudNumericField T="int"
                                 @bind-Value="todoTask.ProgressTargetUnits"
                                 Label="Progres mērķis"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Min="0"
                                 For="@(() => todoTask.ProgressTargetUnits)" />
            </MudStack>

            <MudTextField @bind-Value="todoTask.ProgressUnitType"
                          Label="Vienības tips"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.ProgressUnitType)" />

            <MudStack Spacing="0" Class="mt-1" Style="max-width: 420px;">
                <MudProgressLinear Color="Color.Primary"
                                   Value="@((todoTask.ProgressTargetUnits > 0)
                                                                                                                                                                                        ? Math.Clamp((double)todoTask.ProgressCurrentUnits / todoTask.ProgressTargetUnits * 100.0, 0, 100)
                                                                                                                                                                                        : 0)"
                                   Class="my-1" />
                <MudText Typo="Typo.caption">
                    @($"{todoTask.ProgressCurrentUnits}/{todoTask.ProgressTargetUnits} {todoTask.ProgressUnitType}")
                </MudText>
            </MudStack>



            <MudCardActions>
                <MudIconButton Icon="@Icons.Material.Filled.Save"
                               Size="Size.Large"
                               Color="Color.Primary"
                               ButtonType="ButtonType.Submit" />
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Size="Size.Medium"
                               Color="Color.Default"
                               OnClick="Cancel" />
            </MudCardActions>
        </EditForm>
    </MudCardContent>
</MudPaper>
