@page "/ToDo/update/{TaskId:int}"
@rendermode InteractiveServer
@using Pilens.Data.Models

    <MudCardContent>
        @* <EditForm method="post" Model="@task" autocomplete="off" OnValidSubmit="UpdateTask"> *@
            <MudForm>
                @* <DataAnnotationsValidator /> *@

            <MudTextField @bind-Value="task.Title"
                          Label="Nosaukums"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => task.Title)" />
            <MudTextField @bind-Value="task.Description"
                          Label="Apraksts"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => task.Description)" />

            <MudStack Direction="Row" Spacing="2">
                <MudTextField @bind-value="task.EffortDuration"
                          Label="Nepieciešamais laiks izpildei"
                              Mask="@(new PatternMask("00:00"))"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="00:30" />
                <MudTextField @bind-value="task.Effort"
                          Label="Grūtības līmenis (1-3)"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="0" />

            </MudStack>

        <MudDatePicker Label="Uzdevuma termiņš" @bind-value=" task.Deadline"></MudDatePicker>
        <MudSelect T="Group" Label="Grupas" MultiSelection="true" @bind-SelectedValues="selectedGroups" >
            @foreach (var group in groups)
            {
                <MudSelectItem Value="@group">@group.Name</MudSelectItem>
            }
        </MudSelect>


            <MudStack Direction="Row" Spacing="2">

                <MudNumericField T="int"
                                 @bind-Value="task.ProgressCurrentUnits"
                             Label="@($"Izpildītie(-ās) {task.ProgressUnitType}")"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense" 
                                 Min="0"
                                 For="@(() => task.ProgressCurrentUnits)" />

                <MudNumericField T="int"
                                 @bind-Value="task.ProgressTargetUnits"
                             Label="@($"Mērķa {task.ProgressUnitType}")"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Min="0"
                                 For="@(() => task.ProgressTargetUnits)" />
            </MudStack>

            <MudTextField @bind-Value="task.ProgressUnitType"
                          Label="Vienības tips"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => task.ProgressUnitType)" />

            <MudStack Spacing="0" Class="mt-1" Style="max-width: 420px;">
                <MudProgressLinear Color="Color.Primary"
                                   Value="@((task.ProgressTargetUnits > 0)
                                                                                                                                                                                        ? Math.Clamp((double)task.ProgressCurrentUnits / task.ProgressTargetUnits * 100.0, 0, 100)
                                                                                                                                                                                        : 0)"
                                   Class="my-1" />
                <MudText Typo="Typo.caption">
                    @($"{task.ProgressCurrentUnits}/{task.ProgressTargetUnits} {task.ProgressUnitType}")
                </MudText>
            </MudStack>



            <MudCardActions>
                <MudIconButton Icon="@Icons.Material.Filled.Save"
                               Size="Size.Large"
                               Color="Color.Primary"
                           OnClick="UpdateTask" />
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Size="Size.Medium"
                               Color="Color.Default"
                               OnClick="Cancel" />
            </MudCardActions>
    </MudForm>

        @* </EditForm> *@
    </MudCardContent>
