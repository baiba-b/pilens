@page "/ToDo/update/{TaskId:int}"
@inject NavigationManager Navigation
@rendermode InteractiveServer
@using Pilens.Data.Models

    <MudCardContent>
        <EditForm method="post" Model="@todoTask" autocomplete="off" OnValidSubmit="UpdateTask">
            <DataAnnotationsValidator />

            <MudTextField @bind-Value="todoTask.Title"
                          Label="Nosaukums"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.Title)" />
            <MudTextField @bind-Value="todoTask.Description"
                          Label="Apraksts"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.Description)" />

            <MudStack Direction="Row" Spacing="2">
                <MudTextField @bind-value="todoTask.EffortDuration"
                          Label="Nepieciešamais laiks izpildei"
                              Mask="@(new PatternMask("00:00"))"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="00:30" />
                <MudTextField @bind-value="todoTask.Effort"
                          Label="Grūtības līmenis (1-3)"
                              Margin="Margin.Dense"
                              Variant="Variant.Outlined"
                              Placeholder="0" />

            </MudStack>

        <MudDatePicker Label="Uzdevuma termiņš" @bind-value=" todoTask.Deadline">

        </MudDatePicker>


            <MudStack Direction="Row" Spacing="2">

                <MudNumericField T="int"
                                 @bind-Value="todoTask.ProgressCurrentUnits"
                             Label="@($"Izpildītie(-ās) {todoTask.ProgressUnitType}")"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense" 
                                 Min="0"
                                 For="@(() => todoTask.ProgressCurrentUnits)" />

                <MudNumericField T="int"
                                 @bind-Value="todoTask.ProgressTargetUnits"
                             Label="@($"Mērķa {todoTask.ProgressUnitType}")"
                                 Variant="Variant.Outlined"
                                 Margin="Margin.Dense"
                                 Min="0"
                                 For="@(() => todoTask.ProgressTargetUnits)" />
            </MudStack>

            <MudTextField @bind-Value="todoTask.ProgressUnitType"
                          Label="Vienības tips"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          For="@(() => todoTask.ProgressUnitType)" />

            <MudStack Spacing="0" Class="mt-1" Style="max-width: 420px;">
                <MudProgressLinear Color="Color.Primary"
                                   Value="@((todoTask.ProgressTargetUnits > 0)
                                                                                                                                                                                        ? Math.Clamp((double)todoTask.ProgressCurrentUnits / todoTask.ProgressTargetUnits * 100.0, 0, 100)
                                                                                                                                                                                        : 0)"
                                   Class="my-1" />
                <MudText Typo="Typo.caption">
                    @($"{todoTask.ProgressCurrentUnits}/{todoTask.ProgressTargetUnits} {todoTask.ProgressUnitType}")
                </MudText>
            </MudStack>



            <MudCardActions>
                <MudIconButton Icon="@Icons.Material.Filled.Save"
                               Size="Size.Large"
                               Color="Color.Primary"
                               ButtonType="ButtonType.Submit" />
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Size="Size.Medium"
                               Color="Color.Default"
                               OnClick="Cancel" />
            </MudCardActions>
        </EditForm>
    </MudCardContent>
