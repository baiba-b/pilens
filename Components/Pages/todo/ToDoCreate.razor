@page "/ToDo/create"
@rendermode InteractiveServer
@using Pilens.Data.DTO
@using System.ComponentModel.DataAnnotations
@inject NavigationManager Navigation
<MudCardContent>
    <EditForm method="post" Model=@todoTaskDto autocomplete="off" OnValidSubmit="CreateTask">
        <DataAnnotationsValidator />

        <MudTextField @bind-Value="todoTaskDto.Title"
            Label="Nosaukums"
            Variant="Variant.Outlined"
            Margin="Margin.Dense"
            For="@(() => todoTaskDto.Title)" />
        <MudTextField @bind-Value="todoTaskDto.Description" 
            Label="Apraksts"
            Variant="Variant.Outlined"
            Margin="Margin.Dense"
            For="@(() => todoTaskDto.Description)" />
  
        <MudStack Direction="Row" Spacing="2">
            <MudTextField @bind-value="todoTaskDto.EffortDuration"
                          Label="Nepieciešamais laiks izpildei"
                          Mask="@(new PatternMask("00:00"))"
                          Margin="Margin.Dense"
                          Variant="Variant.Outlined"
                          Placeholder="00:30" />
            <MudTextField @bind-value="todoTaskDto.Effort"
                          Label="Grūtības līmenis (1-3)"
                          Margin="Margin.Dense"
                          Variant="Variant.Outlined"
                          Placeholder="0" />

        </MudStack>

        <MudDatePicker Label="Uzdevuma termiņš" @bind-value=" todoTaskDto.Deadline">

                      </MudDatePicker>

        <MudStack Direction="Row" AlignItems=AlignItems.Center Spacing="1">
   
        </MudStack>

        <MudStack Direction="Row" Spacing="2">

            <MudNumericField T="int"
                             @bind-Value="todoTaskDto.ProgressCurrentUnits"
                             Label="@($"Izpildītie(-ās) {todoTaskDto.ProgressUnitType}")"
                             Variant="Variant.Outlined"
                             Margin="Margin.Dense"
                             Min="0"
                             For="@(() => todoTaskDto.ProgressCurrentUnits)" />

            <MudNumericField T="int"
                             @bind-Value="todoTaskDto.ProgressTargetUnits"
                             Label="@($"Mērķa {todoTaskDto.ProgressUnitType}")"
                             Variant="Variant.Outlined"
                             Margin="Margin.Dense"
                             Min="0"
                             For="@(() => todoTaskDto.ProgressTargetUnits)" />
        </MudStack>

        <MudTextField @bind-Value="todoTaskDto.ProgressUnitType"
                      Label="Vienības tips"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense"
                      For="@(() => todoTaskDto.ProgressUnitType)" />

        <MudStack Spacing="0" Class="mt-1" Style="max-width: 420px;">
            <MudProgressLinear Color="Color.Primary"
                               Value="@((todoTaskDto.ProgressTargetUnits > 0)
                                                                                                                                                     ? Math.Clamp((double)todoTaskDto.ProgressCurrentUnits / todoTaskDto.ProgressTargetUnits * 100.0, 0, 100)
                                                                                                                                                     : 0)"
                               Class="my-1" />
            <MudText Typo="Typo.caption">
                @($"{todoTaskDto.ProgressCurrentUnits}/{todoTaskDto.ProgressTargetUnits} {todoTaskDto.ProgressUnitType}")
            </MudText>
        </MudStack>
        <MudSelect T="GroupDTO" Label="Grupas" MultiSelection="true" @bind-SelectedValues="selectedGroups">
            @foreach (var group in groups)
            {
                <MudSelectItem Value="@group">@group.Name</MudSelectItem>
            }
        </MudSelect>
       

        <MudCardActions>
            <MudIconButton Icon="@Icons.Material.Filled.AddCircle"
                           Size="Size.Large"
                           Color="Color.Primary"
                           ButtonType="ButtonType.Submit" />
            <MudIconButton Icon="@Icons.Material.Filled.Close"
                           Size="Size.Medium"
                           Color="Color.Default"
                           OnClick="Cancel" />
        </MudCardActions>
    </EditForm>
</MudCardContent>

